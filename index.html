<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Albion Market</title>
  <meta name="color-scheme" content="dark light" />
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">
          <h1>Albion Market</h1>
          <p>Stock-style charting + watchlist + item picker</p>
        </div>
      </div>

      <div class="actions">
        <div class="chip" id="clock">—</div>
        <button class="btn ghost" id="themeBtn" type="button">Theme</button>
        <button class="btn" id="refreshBtn" type="button">Refresh</button>
      </div>
    </div>

    <div class="grid">
      <!-- Left -->
      <div class="card">
        <div class="head">
          <div>
            <h2>Controls</h2>
            <div class="sub">Pick an item, then load. Add favorites to your ticker board.</div>
          </div>
        </div>

        <div class="body">
          <div class="form">
            <div class="field">
              <label>Server</label>
              <select class="control" id="region">
                <option value="west" selected>West</option>
                <option value="east">East</option>
                <option value="europe">Europe</option>
              </select>
            </div>

            <div class="field">
              <label>City</label>
              <select class="control" id="city">
                <option>Caerleon</option>
                <option>Thetford</option>
                <option>Lymhurst</option>
                <option>Bridgewatch</option>
                <option>Martlock</option>
                <option>Fort Sterling</option>
                <option>Brecilien</option>
              </select>
            </div>

            <div class="field full">
              <label>Item</label>
              <div class="itemRow">
                <input class="control" id="item" placeholder="Pick an item…" readonly />
                <button class="btn" id="openPickerBtn" type="button">Pick</button>
              </div>
              <div class="small" style="margin-top:8px;">
                Selected item_id: <strong id="itemIdDisplay">T4_BAG</strong>
              </div>
            </div>

            <div class="field">
              <label>Quality</label>
              <select class="control" id="quality">
                <option value="1" selected>1 (Normal)</option>
                <option value="2">2 (Good)</option>
                <option value="3">3 (Outstanding)</option>
                <option value="4">4 (Excellent)</option>
                <option value="5">5 (Masterpiece)</option>
                <option value="0">0 (Any)</option>
              </select>
            </div>

            <div class="field">
              <label>Time-scale</label>
              <select class="control" id="scale">
                <option value="1">1h</option>
                <option value="6">6h</option>
                <option value="24" selected>24h</option>
                <option value="168">7d</option>
              </select>
            </div>

            <div class="field full">
              <label>Auto refresh</label>
              <select class="control" id="autoRefresh">
                <option value="0" selected>Off</option>
                <option value="60">Every 1 min</option>
                <option value="300">Every 5 min</option>
                <option value="900">Every 15 min</option>
                <option value="1800">Every 30 min</option>
              </select>
            </div>
          </div>

          <div class="row-actions">
            <button class="btn primary" id="loadBtn" type="button">Load</button>
            <button class="btn" id="addWatchBtn" type="button">Add to Watchlist</button>
            <button class="btn ghost" id="clearWatchBtn" type="button">Clear Watchlist</button>
          </div>

          <div id="ok" class="ok"></div>
          <div id="err" class="err"></div>

          <div class="divider"></div>

          <div class="pill">
            <span class="muted">Selection:</span>
            <strong id="selText">—</strong>
          </div>

          <div class="watchlist" id="watchlist" style="margin-top:10px;"></div>

          <div class="small" style="margin-top:10px;">
            Item search uses a locally cached item database (no installs needed).
          </div>
        </div>
      </div>

      <!-- Right -->
      <div class="card">
        <div class="head">
          <div>
            <h2>Chart</h2>
            <div class="sub" id="chartSub">Avg price history (sell) + snapshot</div>
          </div>
        </div>

        <div class="chartWrap">
          <canvas id="chart" width="1400" height="540" aria-label="Price chart" role="img"></canvas>
          <div class="tooltip" id="tip">
            <div class="t1" id="tipT1">—</div>
            <div class="t2" id="tipT2">—</div>
          </div>

          <div class="kpiRow">
            <div class="kpi">
              <div class="label">Current Sell Min</div>
              <div class="value" id="kSell">—</div>
              <div class="hint" id="kSellD">—</div>
            </div>
            <div class="kpi">
              <div class="label">Current Buy Max</div>
              <div class="value" id="kBuy">—</div>
              <div class="hint" id="kBuyD">—</div>
            </div>
            <div class="kpi">
              <div class="label">Trend (history)</div>
              <div class="value" id="kTrend">—</div>
              <div class="hint" id="kTrendD">—</div>
            </div>
          </div>

          <div class="divider"></div>

          <table>
            <thead>
              <tr>
                <th>Item</th><th>City</th><th>Quality</th>
                <th>Sell Min</th><th>Sell Min Date</th>
                <th>Buy Max</th><th>Buy Max Date</th>
              </tr>
            </thead>
            <tbody id="snap"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Item Picker Modal -->
  <div class="modalBackdrop" id="pickerBackdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Item picker">
      <div class="modalHead">
        <div class="modalTitle">
          <b>Item picker</b>
          <span>Search by name (English) or item_id</span>
        </div>
        <div class="modalBtns">
          <button class="btn" id="reloadItemsBtn" type="button">Reload list</button>
          <button class="btn ghost" id="closePickerBtn" type="button">Close</button>
        </div>
      </div>

      <div class="modalBody">
        <div class="modalSearchRow">
          <input class="control" id="pickerSearch" placeholder="Type: bag, cape, omelette, t6…" autocomplete="off" />
          <div class="chip" id="itemsInfo">Items: —</div>
        </div>

        <div class="results" id="pickerResults"></div>
        <div class="small" style="margin-top:10px;">
          If your network blocks GitHub raw downloads, item search may fail; the market chart still works if you know item_id.
        </div>
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>
